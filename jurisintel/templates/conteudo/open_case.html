{% extends 'conteudo/base_conteudo.html' %}
{% load staticfiles %}
{% block title %}JurisIntel - {{ titulo }}{% endblock title %}
{% block styles %}
    <style>
        .temas{
            background-color: #f1f3f4;
        }
        .section-title{
            padding: 3rem 3rem 0 3rem;
        }
        .section-container{
            padding: 1rem 3rem 3rem 3rem;
        }
        .card-container{
            max-height: 15em;
            border: 0;
            box-shadow: #0000001a 0 1px 20px 5px;
        }
        .inside-card{
            max-height: 10em !important;
            margin-bottom: 1em;
            overflow-y: hidden;
        }
        p.card-resumo{
            font-size: 10pt;
            text-align: justify;
        }
        .card-title{
            padding: 1em 1em 0 1em;
            font-weight: 700;
        }
        .card-tags{
            display: flex;
            flex-wrap: wrap;
            flex: 1;
            padding: 0 1em 1em 1em;
        }
        .tag{
            margin-left: 4px;
        }
        .card-add-casos-container{
            border: 2px;
            border-style: dashed;
            border-color: #28a745ad;
        }
        .inside-add-card{
            text-align: center;
        }
        .form-add-files{
            width: 60%;
        }
        .add-case-container{
            margin-top: 2em;
        }
        .add-card-plus{
            font-size: 40pt;
            margin: 0;
            color: #28a745;
        }
        .cases-section-container{
            padding: 1rem 3rem 3rem 3rem;
            flex-wrap: wrap;
        }
        .cases-card{
            margin-top: 30px;
        }
        .card-remove-button{
            position: absolute;
            right: 20px;
            top: 20px;
            cursor: pointer;
        }
        .button-docs-text{
            padding: 8px;
            border: 1px solid #d1d1d1;
            border-radius: 8px;
        }
        .first-part{
            padding: 2em 0 0 0;
        }
        .second-part{
            text-align: justify;
            font-size: 10pt;
            max-width: 80%;
        }
        .main-panel-content {
            display: flex;
            flex-direction: column;
        }

        .open-case-header{
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .open-case-content{
            display: flex;
            padding: 20px 50px;
        {#align-items: center;#}
        {#justify-content: center;#}
        }
        .no-precedents{
            text-align: center;
        }

        .precedents-card{

            border-radius: 5px;
            padding: 15px;
            margin-bottom: 2rem;
            max-height: 20rem;
            overflow-y: hidden;

            font-size: 10pt;
            text-align: justify;

            box-shadow: 0 0 5px 1px #0000004d;
        }
        .open-case-thumbnail{
            width: 200px;
            cursor: pointer;
            box-shadow: 0 1px 20px 5px #0000001a;
            border-radius: 5px;
            transition: 0.5s ease;
        }
        .open-case-thumbnail:hover{
            transform: scale(1.05);
        }
        .open-case-sim-doc, .file-resultado{
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
        }
        .open-case-similares{
            display: flex;
            flex-wrap: wrap;

        }
        .open-case-similares, .similares-container, .open-case-precedents{
            width: 100%;
        }
        .open-case-similares-result{
            padding-top: 3rem;
            width: 100%;
            display: flex;
            flex-direction: row;
            align-items: center;
            flex-wrap: wrap;
        }
        .similares-header{
            text-align: center;
        }
        .similares-docs{
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .main-block{
            display: flex;
        }
        .side-bar{
            position: sticky;
        {#border-right: 1px solid #7e7e7e45;#}
            height: calc(100vh - 4rem);
            top: 4rem;
            -webkit-box-shadow: 0px 0px 28px 0px rgba(82,63,105,0.08);
            box-shadow: 0px 0px 28px 0px rgba(82,63,105,0.08);
        }
        .side-bar-items{
            justify-content: center;
            display: flex;
            flex-direction: column;
            padding: 3rem 0;
        }
        .side-panel{
            padding-left: 0;
        }
        .side-button{
            padding: 10px 0;
            display: flex;
            align-items: center;
            color: #313752;
            transition: color 0.3s;
        }
        .side-button__description, .side-button:hover{
            font-weight: 500;
        }
        .side-button:hover{
            color: #5d78ff;
        }
        .side-button-icon{
            display: inline-block;
            min-width: 2.75rem;
            font-size: 1.0625rem;
            line-height: 1.40625rem;
            font-weight: 400;
        }

        .navbar-light{
            position: sticky;
            top: 0;
            z-index: 999;
            background-color: #fff !important;
            -webkit-box-shadow: 0px 0px 40px 0px rgba(82,63,105,0.1);
            box-shadow: 0px 0px 40px 0px rgba(82,63,105,0.1);
            border: 0;
        }
        .nav-item{
            margin-right: 5px;
        }
        .nav-item.active .nav-link{
            color: #5d78ff !important;
            background-color: #f0f3ff;
            border-radius: 4px;
        }
        .nav-item .nav-link{
            color: #6c7293 !important;
            font-weight: 500;
            transition: color, background-color 0.3s;
        }
        .nav-link:hover{
            color: #5d78ff !important;
            background-color: #f0f3ff;
            border-radius: 4px;
        }

        .wrap {
            display: none;
            position: absolute;
            top: 0;
            width: 100%;
            height: 100vh;
            justify-content: center;
            background-color: white;
        {#transform: translate(-50%, -50%);#}
        }
        .carregando{
            max-height: 100vh;
        }
        .filters{
            padding-top: 10px;
        }
        .text {
            color: #fbae17;
            display: inline-block;
            margin-left: 5px;
        }
        .loading{
            position: absolute;
            top: 50%;
            left: 43%;
        }
        .bounceball {
            position: relative;
            display: inline-block;
            height: 37px;
            width: 15px;
        }
        .bounceball::before{
            position: absolute;
            content: '';
            display: block;
            top: 0;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: #fbae17;
            transform-origin: 50%;
            animation: bounce 500ms alternate infinite ease;
        }

        @keyframes bounce {
            0% {
                top: 30px;
                height: 5px;
                border-radius: 60px 60px 20px 20px;
                transform: scaleX(2);
            }
            35% {
                height: 15px;
                border-radius: 50%;
                transform: scaleX(1);
            }
            100% {
                top: 0;
            }
        }

        .offcanvas-panel{
            z-index: 1001;
            position: fixed;
            -webkit-overflow-scrolling: touch;
            top: 0;
            bottom: 0;
            overflow-y: auto;
            -webkit-transform: translate3d(0, 0, 0);
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            width: 425px !important;
            -webkit-transition: left 0.3s ease,right 0.3s ease;
            transition: left 0.3s ease,right 0.3s ease;
            right: -445px;
        }

        .offcanvas-panel{
            background-color: #fff;
            -webkit-box-shadow: 0px 0px 28px 0px rgba(82,63,105,0.13);
            box-shadow: 0px 0px 28px 0px rgba(82,63,105,0.13);
            height: 100vh;
        }

        .offcanvas-panel--on {
            -webkit-transition: left 0.3s ease, right 0.3s ease;
            transition: left 0.3s ease, right 0.3s ease;
            right: 0;
        }
        .offcanvas-panel_header{
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: justify;
            -ms-flex-pack: justify;
            justify-content: space-between;
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            padding: 1.5rem;
        }
        .offcanvas-panel_body{
            position: relative;
            height: calc(100vh - 3rem);
            padding: 0 0.5rem 1rem 0.5rem;
        }
        .offcanvas-panel-close{
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            width: 28px;
            height: 28px;
            background-color: #f7f8fa;
            -webkit-transition: all 0.3s;
            transition: all 0.3s;
            border-radius: 4px;
        }
        .offcanvas-close-icon{
            -webkit-transition: all 0.3s;
            transition: all 0.3s;
            font-size: 0.8rem;
            color: #a1a8c3;
        }
        .offcanvas-panel__title{
            font-size: 1.4rem;
            font-weight: 500;
            color: #3d4465;
            margin: 0;
            padding: 0;
        }
        .panel-nav{
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: start;
            -ms-flex-align: start;
            align-items: flex-start;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
        }
        .panel-item {
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            width: calc(50% - 3px);
            min-height: 180px;
            border-radius: 6px;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -ms-flex-direction: column;
            flex-direction: column;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            padding: 1rem;
            background: #f7f8fa;
            -webkit-transition: all 0.3s;
            transition: all 0.3s;
            margin: 1px;
            text-align: center;
            overflow: hidden;
        }
        .panel-item__link{
            width: 100%;
        }
        .mini-thumb{
            width: 150px;
        }
    </style>
{% endblock styles %}
{% block navitems %}
    <li class="nav-item">
        <a class="nav-link" href="{% url 'conteudo:home' %}">Início </a>
    </li>
    {% if user.is_authenticated %}
        <li class="nav-item">
            <a class="nav-link" href="{% url 'logout' %}">Sair </a>
        </li>
    {% endif %}
    {% if user.is_superuser %}
        <li class="nav-item">
            <a class="nav-link" href="{% url 'admin:index' %}">Admin</a>
        </li>
    {% endif %}
{% endblock navitems %}
{% block sections %}
    <!-- Main Block -->
    <div class="main-block">
        <div id="panel_docs" class="offcanvas-panel">
            <div class="offcanvas-panel_header">
                <h3 class="offcanvas-panel__title">Documentos</h3>
                <button id="close-offcanvas-docs" class="btn offcanvas-panel-close">
                    <i class="fas fa-times offcanvas-close-icon"></i>
                </button>
            </div>
            <div class="offcanvas-panel_body">
                <div class="panel-nav" id="js-docs-panel-nav">
                    {% include 'conteudo/includes/docs_view.html' %}
                </div>
            </div>
        </div>
        <div id="panel_tags" class="offcanvas-panel">
            <div class="offcanvas-panel_header">
                <h3 class="offcanvas-panel__title">Tags</h3>
                <button id="close-offcanvas-tags" class="btn offcanvas-panel-close">
                    <i class="fas fa-times offcanvas-close-icon"></i>
                </button>
            </div>
            <div class="offcanvas-panel_body">
                <div class="panel-nav">
                    {% for tag in tags %}
                        <span class="badge badge-pill badge-danger tag m-1">{{ tag }}</span>
                    {% endfor %}
                </div>
            </div>
        </div>
        <!-- Side Panel -->
        <section class="side-panel col-2 col-md-1">
            <div class="side-bar">
                <div class="side-bar-items">
                    <button class="btn side-button" id="docs" data-toggle="tooltip" data-placement="top" title="Documentos">
                        <i class="far fa-folder-open side-button-icon"></i>
                        <span class="side-button__description">Docs</span>
                    </button>
                    <button class="btn side-button" id="tags" data-toggle="tooltip" data-placement="top" title="Tags">
                        <i class="fas fa-tags side-button-icon"></i>
                        <span class="side-button__description">Tags</span>
                    </button>
                </div>
            </div>
        </section>
        <!-- Main Panel -->
        <section class="main-panel col-10">
            <div class="open-case-header">
                <div class="first-part">
                    <h5>{{ titulo }}</h5>
                </div>
                <div class="second-part">
                    {% if resumo_fit %}
                        <p class="ver-mais">{{ resumo_fit }}</p>
                        <a class="ver-mais-resumo" data-resumo-fit="{{ resumo_fit }}" data-resumo="{{ resumo }}"
                           role='button' data-expand="false" href="#">Ver mais</a>
                    {% else %}
                        <p>{{ resumo }}</p>
                    {% endif %}
                </div>
                <div class="filters">
                    <a href="{% url 'conteudo:precedents' pk %}" id="js-precedentes">Ementas</a> |
                    <a href="{% url 'conteudo:similarities' pk %}" id="js-similar">Similares</a> <!--|-->
                    <!-- <a href="">Temas</a> -->
                </div>
            </div>
            <section class="main-panel-content">
                <div class="open-case-content">
                    {% include 'conteudo/includes/similares.html' %}
                </div>
            </section>
        </section>
    </div>
    <div class="wrap" id="loading">
        <div class="loading">
            <div class="bounceball"></div>
            <div class="text">BUSCANDO SIMILARES</div>
        </div>
    </div>

{% endblock sections %}
{% block scripts %}
    <script>
        $(document).ready(function () {
            $('.precedents-text').click(function () {
                let size = $(this).height();
                let card = $(this).parent('.precedents-card');

                if (card.height() === size+10)
                    card.css('maxHeight', '20rem');
                else if (card.height() === '20rem')
                    card.css('maxHeight', size+10);
                else
                    console.log(card.height())
            });

            $('#js-similar').click(function (e) {
                e.preventDefault();
                let url = $(this).prop('href');
                $.ajax({
                    url: url,
                    method: 'get',
                    global: false,
                    success: function(response){
                        $('.open-case-content').empty();
                        $('.open-case-content').html(response['html_similares']);
                    }
                })
            });

            $('#js-precedentes').click(function (e) {
                e.preventDefault();
                let url = $(this).prop('href');
                $.ajax({
                    url: url,
                    method: 'get',
                    global: false,
                    success: function(response){
                        $('.open-case-content').empty();
                        $('.open-case-content').html(response['html_precedents']);
                    }
                })
            });

            $('.js-remover-arquivo').click(function () {
                let url = $(this).data('url');
                let csrf = $(this).data('data');
                let find = $(this).data('find');
                $.ajax({
                    url: url,
                    method: 'post',
                    data: {
                        'csrfmiddlewaretoken': csrf,
                        'case_id': find,
                    },
                    global: false,
                    success: function (response) {
                        if (response.is_valid){
                            $('#js-docs-panel-nav').empty().html(response.html_docs);
                            $('.similares-docs').empty().html(response.html_docs);
                        }
                    }
                })
            });

            $('.ver-mais-resumo').click(function (e) {
                e.preventDefault();
                let texto = $('.ver-mais');
                let resumo = $(this).data('resumo');
                let resumo_fit = $(this).data('resumo-fit');
                let expand = $(this).data('expand');
                if (expand === false){
                    texto.text(resumo);
                    $(this).data('expand', true);
                    $(this).text('Ver menos');
                }
                else{
                    texto.text(resumo_fit);
                    $(this).data('expand', false);
                    $(this).text('Ver mais');
                }

            });

            $('#docs').click(function () {
                $('#panel_docs').toggleClass('offcanvas-panel--on');
            });
            $('#close-offcanvas-docs').click(function () {
                $('#panel_docs').removeClass('offcanvas-panel--on');
            });

            $('#tags').click(function () {
                $('#panel_tags').toggleClass('offcanvas-panel--on');
            });
            $('#close-offcanvas-tags').click(function () {
                $('#panel_tags').removeClass('offcanvas-panel--on');
            })
        });
    </script>
{% endblock %}